<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å„²å€¼å¡ç®¡ç† - å¨å®‡å½±åŸ</title>
    <link rel="stylesheet" href="/WeiYuCinema/static/css/style.css">
</head>
<body>
    <!-- é é¦–ä½”ä½ç¬¦ -->
    <div id="header-placeholder"></div>
    
    <!-- ä¸»è¦å…§å®¹ -->
    <div class="container">
        <div class="page-title">
            <h1>å„²å€¼å¡ç®¡ç†</h1>
            <p>ç®¡ç†æ‚¨çš„å„²å€¼å¡é¤˜é¡èˆ‡äº¤æ˜“è¨˜éŒ„</p>
        </div>
        
        <!-- æˆåŠŸ/éŒ¯èª¤è¨Šæ¯ -->
        <?php if ($success): ?>
            <div class="section-box">
                <div class="success-message" style="background: #28a745; color: white; padding: 15px; border-radius: 8px; text-align: center; margin-bottom: 0;">
                    <?php
                    switch ($success) {
                        case 'topup':
                            echo 'ğŸ’° å„²å€¼æˆåŠŸï¼é¤˜é¡å·²æ›´æ–°';
                            break;
                        default:
                            echo 'âœ… æ“ä½œæˆåŠŸï¼';
                    }
                    ?>
                </div>
            </div>
        <?php endif; ?>
        
        <?php if ($error): ?>
            <div class="section-box">
                <div class="error-message" style="background: #dc3545; color: white; padding: 15px; border-radius: 8px; text-align: center; margin-bottom: 0;">
                    <?php
                    switch ($error) {
                        case 'invalid_amount':
                            echo 'âŒ å„²å€¼é‡‘é¡ç„¡æ•ˆï¼Œè«‹è¼¸å…¥æ­£æ•´æ•¸';
                            break;
                        case 'insufficient_funds':
                            echo 'âŒ é¤˜é¡ä¸è¶³ï¼Œç„¡æ³•å®Œæˆäº¤æ˜“';
                            break;
                        case 'transaction_failed':
                            echo 'âŒ äº¤æ˜“å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦';
                            break;
                        default:
                            echo 'âŒ æ“ä½œå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦';
                    }
                    ?>
                </div>
            </div>
        <?php endif; ?>
        
        <!-- å„²å€¼å¡è³‡è¨Š -->
        <div class="section-box">
            <h2 class="section-title">ğŸ’³ æˆ‘çš„å„²å€¼å¡</h2>
            <div class="card-display" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 15px; padding: 30px; color: white; text-align: center; position: relative; overflow: hidden;">
                <div style="position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%;"></div>
                <div style="position: absolute; bottom: -30px; left: -30px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%;"></div>
                
                <div style="position: relative; z-index: 2;">
                    <h3 style="margin: 0 0 10px 0; font-size: 24px;">å¨å®‡å½±åŸå„²å€¼å¡</h3>
                    <p style="margin: 0 0 20px 0; opacity: 0.9;">æœƒå“¡ç·¨è™Ÿ: <?php echo htmlspecialchars($memberId); ?></p>
                    
                    <div class="balance-display" style="margin: 20px 0;">
                        <div style="font-size: 16px; opacity: 0.8; margin-bottom: 5px;">ç›®å‰é¤˜é¡</div>
                        <div class="balance" style="font-size: 48px; font-weight: bold; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">
                            NT$ <?php echo number_format($balance); ?>
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; margin-top: 30px; font-size: 14px; opacity: 0.8;">
                        <span>MEMBER CARD</span>
                        <span><?php echo htmlspecialchars($memberName); ?></span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- å„²å€¼åŠŸèƒ½ -->
        <div class="section-box">
            <h2 class="section-title">ğŸ’° ç·šä¸Šå„²å€¼</h2>
            <form action="topup_process.php" method="POST" id="topupForm">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div class="form-group">
                        <label for="amount">å„²å€¼é‡‘é¡ <span style="color: #dc3545;">*</span></label>
                        <input type="number" id="amount" name="amount" min="100" max="10000" step="100" required placeholder="è«‹è¼¸å…¥å„²å€¼é‡‘é¡">
                        <small class="text-muted">æœ€ä½å„²å€¼é‡‘é¡: NT$ 100ï¼Œæœ€é«˜: NT$ 10,000</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="paymentMethod">ä»˜æ¬¾æ–¹å¼ <span style="color: #dc3545;">*</span></label>
                        <select id="paymentMethod" name="paymentMethod" required>
                            <option value="">è«‹é¸æ“‡ä»˜æ¬¾æ–¹å¼</option>
                            <option value="credit_card">ä¿¡ç”¨å¡</option>
                            <option value="debit_card">é‡‘èå¡</option>
                            <option value="bank_transfer">éŠ€è¡Œè½‰å¸³</option>
                            <option value="mobile_pay">è¡Œå‹•æ”¯ä»˜</option>
                        </select>
                    </div>
                </div>
                
                <!-- å¿«é€Ÿé‡‘é¡é¸æ“‡ -->
                <div class="quick-amounts" style="margin-bottom: 30px;">
                    <label style="display: block; margin-bottom: 15px; font-weight: bold;">å¿«é€Ÿé¸æ“‡é‡‘é¡:</label>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button type="button" class="btn btn-secondary quick-amount" data-amount="500" style="padding: 10px 20px;">NT$ 500</button>
                        <button type="button" class="btn btn-secondary quick-amount" data-amount="1000" style="padding: 10px 20px;">NT$ 1,000</button>
                        <button type="button" class="btn btn-secondary quick-amount" data-amount="2000" style="padding: 10px 20px;">NT$ 2,000</button>
                        <button type="button" class="btn btn-secondary quick-amount" data-amount="3000" style="padding: 10px 20px;">NT$ 3,000</button>
                        <button type="button" class="btn btn-secondary quick-amount" data-amount="5000" style="padding: 10px 20px;">NT$ 5,000</button>
                    </div>
                </div>
                
                <div class="text-center">
                    <button type="submit" class="btn btn-primary" style="padding: 15px 40px; font-size: 18px;">
                        ğŸ’³ ç«‹å³å„²å€¼
                    </button>
                </div>
            </form>
        </div>
        
        <!-- æœ€è¿‘äº¤æ˜“è¨˜éŒ„ -->
        <div class="section-box">
            <h2 class="section-title">ğŸ“Š æœ€è¿‘äº¤æ˜“è¨˜éŒ„</h2>
            
            <?php if (!empty($recentTransactions)): ?>
                <div class="transaction-list">
                    <?php foreach ($recentTransactions as $transaction): ?>
                        <div class="transaction-item" style="background: #2c2c2c; border-radius: 10px; padding: 20px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                            <div class="transaction-info">
                                <div class="transaction-type" style="font-weight: bold; margin-bottom: 5px;">
                                    <?php if ($transaction['transactionType'] === 'TOPUP'): ?>
                                        <span style="color: #28a745;">ğŸ’° å„²å€¼</span>
                                    <?php else: ?>
                                        <span style="color: #dc3545;">ğŸŸï¸ æ¶ˆè²»</span>
                                    <?php endif; ?>
                                </div>
                                <div class="transaction-desc" style="color: var(--text-muted); font-size: 14px;">
                                    <?php echo htmlspecialchars($transaction['description']); ?>
                                </div>
                                <div class="transaction-date" style="color: var(--text-muted); font-size: 12px; margin-top: 5px;">
                                    <?php echo date('Y/m/d H:i', strtotime($transaction['transactionDate'])); ?>
                                </div>
                            </div>
                            
                            <div class="transaction-amount" style="text-align: right;">
                                <div class="amount" style="font-size: 18px; font-weight: bold; <?php echo $transaction['transactionType'] === 'TOPUP' ? 'color: #28a745;' : 'color: #dc3545;'; ?>">
                                    <?php echo $transaction['transactionType'] === 'TOPUP' ? '+' : '-'; ?>NT$ <?php echo number_format($transaction['amount']); ?>
                                </div>
                                <div class="balance-after" style="font-size: 12px; color: var(--text-muted);">
                                    é¤˜é¡: NT$ <?php echo number_format($transaction['balanceAfter']); ?>
                                </div>
                            </div>
                        </div>
                    <?php endforeach; ?>
                </div>
                
                <div class="text-center" style="margin-top: 30px;">
                    <a href="transaction_history.php" class="btn btn-info">
                        ğŸ“‹ æŸ¥çœ‹å®Œæ•´äº¤æ˜“è¨˜éŒ„
                    </a>
                </div>
            <?php else: ?>
                <div class="text-center" style="padding: 60px 20px;">
                    <div style="font-size: 64px; margin-bottom: 20px; opacity: 0.3;">ğŸ’³</div>
                    <h3 class="text-muted">å°šç„¡äº¤æ˜“è¨˜éŒ„</h3>
                    <p class="text-muted">é–‹å§‹æ‚¨çš„ç¬¬ä¸€æ¬¡å„²å€¼å§ï¼</p>
                </div>
            <?php endif; ?>
        </div>
        
        <!-- è¿”å›æŒ‰éˆ• -->
        <div class="text-center" style="margin-top: 40px;">
            <a href="../index.php" class="btn btn-secondary" style="padding: 15px 30px; font-size: 16px;">
                â† è¿”å›æœƒå“¡é¦–é 
            </a>
        </div>
    </div>
    
    <!-- é å°¾ä½”ä½ç¬¦ -->
    <div id="footer-placeholder"></div>
    
    <!-- è¼‰å…¥æ ¸å¿ƒJavaScript -->
    <script src="/WeiYuCinema/static/js/script.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // å¿«é€Ÿé‡‘é¡é¸æ“‡
            document.querySelectorAll('.quick-amount').forEach(button => {
                button.addEventListener('click', function() {
                    const amount = this.dataset.amount;
                    document.getElementById('amount').value = amount;
                    
                    // è¦–è¦ºå›é¥‹
                    document.querySelectorAll('.quick-amount').forEach(btn => {
                        btn.classList.remove('btn-primary');
                        btn.classList.add('btn-secondary');
                    });
                    this.classList.remove('btn-secondary');
                    this.classList.add('btn-primary');
                });
            });
            
            // å„²å€¼è¡¨å–®é©—è­‰
            const topupForm = document.getElementById('topupForm');
            if (topupForm) {
                topupForm.addEventListener('submit', function(e) {
                    const amount = parseInt(document.getElementById('amount').value);
                    const paymentMethod = document.getElementById('paymentMethod').value;
                    
                    if (!amount || amount < 100) {
                        e.preventDefault();
                        showNotification('å„²å€¼é‡‘é¡ä¸èƒ½å°‘æ–¼ NT$ 100', 'error');
                        return false;
                    }
                    
                    if (amount > 10000) {
                        e.preventDefault();
                        showNotification('å–®æ¬¡å„²å€¼é‡‘é¡ä¸èƒ½è¶…é NT$ 10,000', 'error');
                        return false;
                    }
                    
                    if (!paymentMethod) {
                        e.preventDefault();
                        showNotification('è«‹é¸æ“‡ä»˜æ¬¾æ–¹å¼', 'error');
                        return false;
                    }
                    
                    // ç¢ºèªå°è©±æ¡†
                    if (!confirm(`ç¢ºå®šè¦å„²å€¼ NT$ ${amount.toLocaleString()} å—ï¼Ÿ`)) {
                        e.preventDefault();
                        return false;
                    }
                    
                    showNotification('æ­£åœ¨è™•ç†å„²å€¼...', 'info');
                });
            }
            
            // é‡‘é¡è¼¸å…¥æ ¼å¼åŒ–
            const amountInput = document.getElementById('amount');
            if (amountInput) {
                amountInput.addEventListener('input', function() {
                    // ç§»é™¤éæ•¸å­—å­—å…ƒ
                    this.value = this.value.replace(/[^0-9]/g, '');
                    
                    // é™åˆ¶æœ€å¤§å€¼
                    if (parseInt(this.value) > 10000) {
                        this.value = '10000';
                    }
                });
            }
        });
    </script>
</body>
</html>