<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœƒå“¡è³‡æ–™ç®¡ç† - å¨å®‡å½±åŸ</title>
    <link rel="stylesheet" href="/WeiYuCinema/static/css/style.css">
</head>
<body>
    <!-- é é¦–ä½”ä½ç¬¦ -->
    <div id="header-placeholder"></div>
    
    <!-- ä¸»è¦å…§å®¹ -->
    <div class="container">
        <div class="page-title">
            <h1>æœƒå“¡è³‡æ–™ç®¡ç†</h1>
            <p>ç®¡ç†æ‚¨çš„å€‹äººè³‡æ–™èˆ‡å¸³è™Ÿè¨­å®š</p>
        </div>
        
        <!-- è¨Šæ¯é¡¯ç¤º -->
        <?php if (!empty($message)): ?>
            <div class="section-box">
                <div class="<?php echo $messageType === 'success' ? 'success' : 'error'; ?>-message" 
                     style="background: <?php echo $messageType === 'success' ? '#28a745' : '#dc3545'; ?>; color: white; padding: 15px; border-radius: 8px; text-align: center; margin-bottom: 0;">
                    <?php echo htmlspecialchars($message); ?>
                </div>
            </div>
        <?php endif; ?>
        
        <!-- ç›®å‰æœƒå“¡è³‡æ–™ -->
        <div class="section-box">
            <h2 class="section-title">ğŸ“‹ ç›®å‰æœƒå“¡è³‡æ–™</h2>
            <div style="background: #2c2c2c; border-radius: 10px; padding: 25px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div class="info-item">
                        <div class="info-label" style="color: var(--primary-color); font-weight: bold; margin-bottom: 5px;">æœƒå“¡ç·¨è™Ÿ</div>
                        <div class="info-value" style="font-size: 18px;"><?php echo htmlspecialchars($_SESSION['memberId']); ?></div>
                    </div>
                    <div class="info-item">
                        <div class="info-label" style="color: var(--primary-color); font-weight: bold; margin-bottom: 5px;">å§“å</div>
                        <div class="info-value" style="font-size: 18px;"><?php echo htmlspecialchars($profile['memberName'] ?? ''); ?></div>
                    </div>
                    <div class="info-item">
                        <div class="info-label" style="color: var(--primary-color); font-weight: bold; margin-bottom: 5px;">é›»å­ä¿¡ç®±</div>
                        <div class="info-value" style="font-size: 18px;"><?php echo htmlspecialchars($profile['member'] ?? ''); ?></div>
                    </div>
                    <div class="info-item">
                        <div class="info-label" style="color: var(--primary-color); font-weight: bold; margin-bottom: 5px;">æ‰‹æ©Ÿè™Ÿç¢¼</div>
                        <div class="info-value" style="font-size: 18px;"><?php echo htmlspecialchars($profile['memberPhone'] ?? ''); ?></div>
                    </div>
                    <div class="info-item">
                        <div class="info-label" style="color: var(--primary-color); font-weight: bold; margin-bottom: 5px;">ç”Ÿæ—¥</div>
                        <div class="info-value" style="font-size: 18px;"><?php echo htmlspecialchars($profile['memberBirth'] ?? ''); ?></div>
                    </div>
                    <div class="info-item">
                        <div class="info-label" style="color: var(--primary-color); font-weight: bold; margin-bottom: 5px;">ä»˜æ¬¾å¸³è™Ÿ</div>
                        <div class="info-value" style="font-size: 18px;"><?php echo htmlspecialchars($profile['memberPayAccount'] ?? 'æœªè¨­å®š'); ?></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ä¿®æ”¹åŸºæœ¬è³‡æ–™ -->
        <div class="section-box">
            <h2 class="section-title">âœï¸ ä¿®æ”¹åŸºæœ¬è³‡æ–™</h2>
            <form action="update_profile.php" method="POST" id="profileForm">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div class="form-group">
                        <label>æœƒå“¡ç·¨è™Ÿ</label>
                        <input type="text" value="<?php echo htmlspecialchars($_SESSION['memberId']); ?>" readonly style="background: #444; color: var(--text-muted);">
                    </div>
                    <div class="form-group">
                        <label for="memberName">å§“å <span style="color: #dc3545;">*</span></label>
                        <input type="text" id="memberName" name="memberName" value="<?php echo htmlspecialchars($profile['memberName'] ?? ''); ?>" required maxlength="20" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å">
                    </div>
                    <div class="form-group">
                        <label for="member">é›»å­ä¿¡ç®± <span style="color: #dc3545;">*</span></label>
                        <input type="email" id="member" name="member" value="<?php echo htmlspecialchars($profile['member'] ?? ''); ?>" required maxlength="50" placeholder="example@email.com">
                    </div>
                    <div class="form-group">
                        <label for="memberPhone">æ‰‹æ©Ÿè™Ÿç¢¼ <span style="color: #dc3545;">*</span></label>
                        <input type="tel" id="memberPhone" name="memberPhone" value="<?php echo htmlspecialchars($profile['memberPhone'] ?? ''); ?>" required maxlength="10" pattern="09[0-9]{8}" placeholder="09xxxxxxxx">
                    </div>
                    <div class="form-group">
                        <label for="memberBirth">ç”Ÿæ—¥ <span style="color: #dc3545;">*</span></label>
                        <input type="date" id="memberBirth" name="memberBirth" value="<?php echo htmlspecialchars($profile['memberBirth'] ?? ''); ?>" required>
                    </div>
                    <div class="form-group">
                        <label for="memberPayAccount">ä»˜æ¬¾å¸³è™Ÿ <span class="text-muted">(é¸å¡«)</span></label>
                        <input type="text" id="memberPayAccount" name="memberPayAccount" value="<?php echo htmlspecialchars($profile['memberPayAccount'] ?? ''); ?>" maxlength="14" placeholder="éŠ€è¡Œå¸³è™Ÿæˆ–ä¿¡ç”¨å¡è™Ÿ">
                    </div>
                </div>
                
                <div class="text-center" style="margin-top: 30px;">
                    <button type="submit" class="btn btn-primary" style="padding: 15px 30px; font-size: 16px;">
                        ğŸ’¾ æ›´æ–°åŸºæœ¬è³‡æ–™
                    </button>
                </div>
            </form>
        </div>
        
        <!-- è®Šæ›´å¯†ç¢¼ -->
        <div class="section-box">
            <h2 class="section-title">ğŸ” è®Šæ›´å¯†ç¢¼</h2>
            <form action="update_password.php" method="POST" id="passwordForm">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div class="form-group">
                        <label for="currentPassword">ç›®å‰å¯†ç¢¼ <span style="color: #dc3545;">*</span></label>
                        <input type="password" id="currentPassword" name="currentPassword" required placeholder="è«‹è¼¸å…¥ç›®å‰å¯†ç¢¼">
                    </div>
                    <div class="form-group">
                        <label for="newPassword">æ–°å¯†ç¢¼ <span style="color: #dc3545;">*</span></label>
                        <input type="password" id="newPassword" name="newPassword" required minlength="6" maxlength="50" placeholder="è‡³å°‘ 6 å€‹å­—å…ƒ">
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">ç¢ºèªæ–°å¯†ç¢¼ <span style="color: #dc3545;">*</span></label>
                        <input type="password" id="confirmPassword" name="confirmPassword" required minlength="6" maxlength="50" placeholder="è«‹å†æ¬¡è¼¸å…¥æ–°å¯†ç¢¼">
                    </div>
                </div>
                
                <div class="text-center" style="margin-top: 30px;">
                    <button type="submit" class="btn btn-warning" style="padding: 15px 30px; font-size: 16px;">
                        ğŸ”‘ æ›´æ–°å¯†ç¢¼
                    </button>
                </div>
            </form>
        </div>
        
        <!-- è¿”å›æŒ‰éˆ• -->
        <div class="text-center" style="margin-top: 40px;">
            <a href="../index.php" class="btn btn-secondary" style="padding: 15px 30px; font-size: 16px;">
                â† è¿”å›æœƒå“¡é¦–é 
            </a>
        </div>
    </div>
    
    <!-- é å°¾ä½”ä½ç¬¦ -->
    <div id="footer-placeholder"></div>
    
    <!-- è¼‰å…¥æ ¸å¿ƒJavaScript -->
    <script src="/WeiYuCinema/static/js/script.js"></script>
    
    <script>
        // è¡¨å–®é©—è­‰å¢å¼·
        document.addEventListener('DOMContentLoaded', function() {
            // å¯†ç¢¼ç¢ºèªé©—è­‰
            const passwordForm = document.getElementById('passwordForm');
            const newPassword = document.getElementById('newPassword');
            const confirmPassword = document.getElementById('confirmPassword');
            
            function validatePassword() {
                if (newPassword.value !== confirmPassword.value) {
                    confirmPassword.style.borderColor = '#dc3545';
                    return false;
                } else {
                    confirmPassword.style.borderColor = '#444';
                    return true;
                }
            }
            
            if (newPassword && confirmPassword) {
                newPassword.addEventListener('input', validatePassword);
                confirmPassword.addEventListener('input', validatePassword);
            }
            
            // å¯†ç¢¼è¡¨å–®æäº¤é©—è­‰
            if (passwordForm) {
                passwordForm.addEventListener('submit', function(e) {
                    if (!validatePassword()) {
                        e.preventDefault();
                        showNotification('å…©æ¬¡è¼¸å…¥çš„å¯†ç¢¼ä¸ä¸€è‡´ï¼', 'error');
                        return false;
                    }
                    
                    if (newPassword.value.length < 6) {
                        e.preventDefault();
                        showNotification('å¯†ç¢¼é•·åº¦è‡³å°‘éœ€è¦ 6 å€‹å­—å…ƒï¼', 'error');
                        return false;
                    }
                    
                    showNotification('æ­£åœ¨æ›´æ–°å¯†ç¢¼...', 'info');
                });
            }
            
            // æ‰‹æ©Ÿè™Ÿç¢¼æ ¼å¼é©—è­‰
            const phoneInput = document.getElementById('memberPhone');
            if (phoneInput) {
                phoneInput.addEventListener('input', function() {
                    this.value = this.value.replace(/[^0-9]/g, '');
                    if (this.value.length > 10) {
                        this.value = this.value.slice(0, 10);
                    }
                    
                    // å³æ™‚é©—è­‰æ ¼å¼
                    if (this.value.length === 10 && this.value.startsWith('09')) {
                        this.style.borderColor = '#28a745';
                    } else if (this.value.length > 0) {
                        this.style.borderColor = '#dc3545';
                    } else {
                        this.style.borderColor = '#444';
                    }
                });
            }
            
            // åŸºæœ¬è³‡æ–™è¡¨å–®æäº¤
            const profileForm = document.getElementById('profileForm');
            if (profileForm) {
                profileForm.addEventListener('submit', function(e) {
                    showNotification('æ­£åœ¨æ›´æ–°è³‡æ–™...', 'info');
                });
            }
            
            // ä»˜æ¬¾å¸³è™Ÿæ ¼å¼åŒ–
            const payAccountInput = document.getElementById('memberPayAccount');
            if (payAccountInput) {
                payAccountInput.addEventListener('input', function() {
                    // ç§»é™¤éè‹±æ•¸å­—å…ƒï¼Œä¸¦è½‰ç‚ºå¤§å¯«
                    this.value = this.value.replace(/[^A-Za-z0-9]/g, '').toUpperCase();
                    if (this.value.length > 14) {
                        this.value = this.value.slice(0, 14);
                    }
                });
            }
        });
    </script>
</body>
</html>