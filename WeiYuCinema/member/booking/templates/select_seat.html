<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¸æ“‡åº§ä½ - å¨å®‡å½±åŸ</title>
    <link rel="stylesheet" href="/WeiYuCinema/static/css/style.css">
    <style>
        /* æ¨£å¼ä¿æŒä¸è®Šï¼Œæ–°å¢ select æ¨£å¼ */
        .seat-map { display: flex; flex-direction: column; align-items: center; gap: 12px; }
        .seat-row { display: flex; gap: 8px; align-items: center; justify-content: center; }
        .row-label { width: 40px; text-align: center; font-weight: bold; font-size: 16px; color: #e0a800; }
        .seat { width: 35px; height: 35px; border: 2px solid; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; cursor: pointer; user-select: none; }
        .seat.available { background: #28a745; border-color: #229954; color: white; }
        .seat.occupied { background: #dc3545; border-color: #c82333; color: white; opacity: 0.6; pointer-events: none; }
        .seat.selected { background: #ffc107 !important; border-color: #e0a800 !important; color: #000 !important; transform: scale(1.1); }
        
        /* ä¸‹æ‹‰é¸å–®ç¾åŒ– */
        .ticket-selector { margin-bottom: 15px; padding: 10px; background: #fff; border-radius: 8px; border: 1px solid #ddd; }
        .ticket-selector select { padding: 5px; font-size: 16px; border-radius: 4px; }
        
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .booking-summary { background: #2c2c2c; color: white; padding: 25px; border-radius: 12px; margin-top: 20px; }
        .btn { padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; text-decoration: none; display: inline-block; }
        .btn:disabled { background-color: #6c757d; cursor: not-allowed; }
    </style>
</head>
<body>
    <div id="header-placeholder"></div>
    <div class="container">
        <div class="page-title">
            <h1>é¸æ“‡åº§ä½</h1>
        </div>
        
        <div class="section-box">
            <div class="showing-info" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 12px;">
                <h3>{{MOVIE_NAME}}</h3>
                <p>{{CINEMA_NAME}} - {{THEATER_NAME}}</p>
                <p>{{SHOWING_DATE}} {{START_TIME}} ({{VERSION_NAME}})</p>
                
                <div class="ticket-selector" style="color: #333; margin-top: 15px;">
                    <label for="ticketTypeSelect"><strong>ğŸ« é¸æ“‡ç¥¨ç¨®ï¼š</strong></label>
                    <select id="ticketTypeSelect" onchange="updatePrice()">
                        {{TICKET_OPTIONS}}
                    </select>
                </div>
            </div>
        </div>
        
        <div class="section-box">
            <h3 class="section-title">ğŸ¬ éŠ€å¹•</h3>
            <div class="screen" style="background: #333; height: 10px; margin-bottom: 30px; border-radius: 50%;"></div>
            <div class="seat-map">
                {{SEAT_MAP}}
            </div>
        </div>
        
        <div class="booking-summary">
            <h3>ğŸ“‹ è¨‚ç¥¨æ‘˜è¦</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <p>å·²é¸åº§ä½ï¼š<span id="selectedSeats" style="color: #ffc107;">å°šæœªé¸æ“‡</span></p>
                    <p>ç¥¨æ•¸ï¼š<span id="ticketCount">0</span> å¼µ</p>
                </div>
                <div>
                    <p>å–®åƒ¹ï¼š<span id="displayPrice">NT$ {{DEFAULT_PRICE}}</span></p>
                    <p>ç¸½é‡‘é¡ï¼š<span id="totalPrice" style="font-size: 24px; color: #ffc107;">NT$ 0</span></p>
                </div>
            </div>
            
            <form action="select_meal.php" method="POST" id="seatForm">
                <input type="hidden" name="showingId" value="{{SHOWING_ID}}">
                <input type="hidden" name="selectedSeats" id="selectedSeatsInput">
                <input type="hidden" name="ticketCount" id="ticketCountInput">
                <input type="hidden" name="totalPrice" id="totalPriceInput">
                <input type="hidden" name="ticketClassId" id="ticketClassIdInput" value="1">
                
                <div style="text-align: center; margin-top: 20px;">
                    <button type="submit" id="nextBtn" class="btn" disabled>ä¸‹ä¸€æ­¥ï¼šé¸æ“‡é¤é»</button>
                </div>
            </form>
        </div>
    </div>
    
    <script src="/WeiYuCinema/static/js/script.js"></script>
    <script>
        let selectedSeats = [];
        let currentPrice = {{DEFAULT_PRICE}}; // åˆå§‹åƒ¹æ ¼
        
        // ç•¶ä½¿ç”¨è€…åˆ‡æ›ç¥¨ç¨®æ™‚ï¼Œæ›´æ–°åƒ¹æ ¼
        function updatePrice() {
            const select = document.getElementById('ticketTypeSelect');
            const option = select.options[select.selectedIndex];
            currentPrice = parseInt(option.dataset.price);
            
            // æ›´æ–°ç•«é¢é¡¯ç¤º
            document.getElementById('displayPrice').textContent = 'NT$ ' + currentPrice;
            document.getElementById('ticketClassIdInput').value = select.value;
            
            // é‡æ–°è¨ˆç®—ç¸½é‡‘é¡
            updateBookingSummary();
        }

        // åº§ä½é»æ“Šé‚è¼¯
        document.body.addEventListener('click', function(e) {
            if (e.target.classList.contains('seat') && e.target.classList.contains('available')) {
                const seatId = e.target.dataset.seat;
                
                if (e.target.classList.contains('selected')) {
                    e.target.classList.remove('selected');
                    selectedSeats = selectedSeats.filter(s => s !== seatId);
                } else {
                    if (selectedSeats.length >= 6) {
                        alert('æœ€å¤šé¸æ“‡ 6 å€‹åº§ä½');
                        return;
                    }
                    e.target.classList.add('selected');
                    selectedSeats.push(seatId);
                }
                updateBookingSummary();
            }
        });
        
        function updateBookingSummary() {
            const count = selectedSeats.length;
            const total = count * currentPrice;
            
            document.getElementById('selectedSeats').textContent = count > 0 ? selectedSeats.join(', ') : 'å°šæœªé¸æ“‡';
            document.getElementById('ticketCount').textContent = count;
            document.getElementById('totalPrice').textContent = 'NT$ ' + total;
            
            // æ›´æ–°éš±è—æ¬„ä½
            document.getElementById('selectedSeatsInput').value = selectedSeats.join(',');
            document.getElementById('ticketCountInput').value = count;
            document.getElementById('totalPriceInput').value = total;
            
            const nextBtn = document.getElementById('nextBtn');
            nextBtn.disabled = count === 0;
            nextBtn.style.opacity = count > 0 ? '1' : '0.5';
        }
        
        // åˆå§‹åŒ–åƒ¹æ ¼
        updatePrice();
    </script>
</body>
</html>