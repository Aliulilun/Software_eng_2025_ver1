<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ë≥ºÁ•®ÊúçÂãô - Â®ÅÂÆáÂΩ±Âüé</title>
    <link rel="stylesheet" href="/WeiYuCinema/static/css/style.css">
</head>
<body>
    <!-- È†ÅÈ¶ñ‰Ωî‰ΩçÁ¨¶ -->
    <div id="header-placeholder"></div>
    
    <!-- ‰∏ªË¶ÅÂÖßÂÆπ -->
    <div class="container">
        <div class="page-title">
            <h1>Ë≥ºÁ•®ÊúçÂãô</h1>
            <p>ÈÅ∏ÊìáÊÇ®ÂñúÊÑõÁöÑÈõªÂΩ±Â†¥Ê¨°ÔºåÁ´ãÂç≥Ë≥ºÁ•®</p>
        </div>
        
        <!-- ÁØ©ÈÅ∏Ê¢ù‰ª∂ -->
        <div class="section-box">
            <h2 class="section-title">üé¨ ÈÅ∏ÊìáÂ†¥Ê¨°</h2>
            <form method="GET" action="" id="filterForm">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="movieId">ÈÅ∏ÊìáÈõªÂΩ±</label>
                        <select id="movieId" name="movieId" onchange="this.form.submit()">
                            <option value="">Ë´ãÈÅ∏ÊìáÈõªÂΩ±</option>
                            <?php foreach ($movies as $movie): ?>
                                <option value="<?php echo $movie['movieId']; ?>" 
                                        <?php echo ($selectedMovie == $movie['movieId']) ? 'selected' : ''; ?>>
                                    <?php echo htmlspecialchars($movie['movieName']); ?>
                                </option>
                            <?php endforeach; ?>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="cinemaId">ÈÅ∏ÊìáÂΩ±Âüé</label>
                        <select id="cinemaId" name="cinemaId" onchange="this.form.submit()">
                            <option value="">Ë´ãÈÅ∏ÊìáÂΩ±Âüé</option>
                            <?php foreach ($cinemas as $cinema): ?>
                                <option value="<?php echo $cinema['cinemaId']; ?>" 
                                        <?php echo ($selectedCinema == $cinema['cinemaId']) ? 'selected' : ''; ?>>
                                    <?php echo htmlspecialchars($cinema['cinemaName']); ?>
                                </option>
                            <?php endforeach; ?>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="showDate">ÈÅ∏ÊìáÊó•Êúü</label>
                        <select id="showDate" name="showDate" onchange="this.form.submit()">
                            <option value="">Ë´ãÈÅ∏ÊìáÊó•Êúü</option>
                            <?php foreach ($availableDates as $date): ?>
                                <option value="<?php echo $date; ?>" 
                                        <?php echo ($selectedDate == $date) ? 'selected' : ''; ?>>
                                    <?php echo date('mÊúàdÊó• (D)', strtotime($date)); ?>
                                </option>
                            <?php endforeach; ?>
                        </select>
                    </div>
                </div>
                
                <div class="text-center">
                    <button type="button" class="btn btn-secondary" onclick="clearFilters()">Ê∏ÖÈô§ÁØ©ÈÅ∏</button>
                </div>
            </form>
        </div>
        
        <!-- Â†¥Ê¨°ÂàóË°® -->
        <div class="section-box">
            <h2 class="section-title">üéüÔ∏è ÂèØÈ†êË®ÇÂ†¥Ê¨°</h2>
            
            <?php if (!empty($showings)): ?>
                <div class="showings-grid" style="display: grid; gap: 20px;">
                    <?php foreach ($showings as $showing): ?>
                        <div class="showing-card" style="background: #2c2c2c; border-radius: 12px; overflow: hidden; transition: transform 0.3s, box-shadow 0.3s;">
                            <div style="display: grid; grid-template-columns: 200px 1fr auto; gap: 20px; padding: 25px; align-items: center;">
                                <!-- ÈõªÂΩ±Êµ∑Â†± -->
                                <div class="movie-poster" style="position: relative;">
                                    <?php if (!empty($showing['movieImg'])): ?>
                                        <img src="/WeiYuCinema/images/movies/<?php echo htmlspecialchars($showing['movieImg']); ?>" 
                                             alt="<?php echo htmlspecialchars($showing['movieName']); ?>" 
                                             style="width: 100%; height: 280px; object-fit: cover; border-radius: 8px;">
                                    <?php else: ?>
                                        <div style="width: 100%; height: 280px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 18px;">
                                            üé¨<br><?php echo htmlspecialchars($showing['movieName']); ?>
                                        </div>
                                    <?php endif; ?>
                                    
                                    <div class="movie-grade" style="position: absolute; top: 10px; right: 10px; background: var(--primary-color); color: #000; padding: 5px 10px; border-radius: 15px; font-weight: bold; font-size: 12px;">
                                        <?php echo htmlspecialchars($showing['gradeName']); ?>
                                    </div>
                                </div>
                                
                                <!-- Â†¥Ê¨°Ë≥áË®ä -->
                                <div class="showing-info">
                                    <h3 style="margin: 0 0 15px 0; color: var(--primary-color); font-size: 24px;">
                                        <?php echo htmlspecialchars($showing['movieName']); ?>
                                    </h3>
                                    
                                    <div class="showing-details" style="margin-bottom: 20px;">
                                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                            <div class="detail-item">
                                                <div style="color: var(--text-muted); font-size: 14px; margin-bottom: 5px;">üè¢ ÂΩ±Âüé</div>
                                                <div style="font-weight: bold;"><?php echo htmlspecialchars($showing['cinemaName']); ?></div>
                                            </div>
                                            <div class="detail-item">
                                                <div style="color: var(--text-muted); font-size: 14px; margin-bottom: 5px;">üé≠ Âª≥Èô¢</div>
                                                <div style="font-weight: bold;"><?php echo htmlspecialchars($showing['theaterName']); ?></div>
                                            </div>
                                            <div class="detail-item">
                                                <div style="color: var(--text-muted); font-size: 14px; margin-bottom: 5px;">üìÖ Êó•Êúü</div>
                                                <div style="font-weight: bold;"><?php echo date('Y/m/d (D)', strtotime($showing['showDate'])); ?></div>
                                            </div>
                                            <div class="detail-item">
                                                <div style="color: var(--text-muted); font-size: 14px; margin-bottom: 5px;">‚è∞ ÊôÇÈñì</div>
                                                <div style="font-weight: bold; color: var(--primary-color);"><?php echo date('H:i', strtotime($showing['showTime'])); ?></div>
                                            </div>
                                            <div class="detail-item">
                                                <div style="color: var(--text-muted); font-size: 14px; margin-bottom: 5px;">‚è±Ô∏è ÁâáÈï∑</div>
                                                <div style="font-weight: bold;"><?php echo htmlspecialchars($showing['movieTime']); ?></div>
                                            </div>
                                            <div class="detail-item">
                                                <div style="color: var(--text-muted); font-size: 14px; margin-bottom: 5px;">üé≠ È°ûÂûã</div>
                                                <div style="font-weight: bold;"><?php echo htmlspecialchars($showing['movieTypeName']); ?></div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Â∫ß‰ΩçÁãÄÊ≥Å -->
                                    <div class="seat-status" style="background: #1a1a1a; padding: 15px; border-radius: 8px;">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div>
                                                <span style="color: var(--text-muted); font-size: 14px;">Â∫ß‰ΩçÁãÄÊ≥ÅÔºö</span>
                                                <span style="color: #28a745; font-weight: bold;">Ââ©È§ò <?php echo $showing['availableSeats']; ?> Â∏≠</span>
                                                <span style="color: var(--text-muted);">/ Á∏ΩÂÖ± <?php echo $showing['totalSeats']; ?> Â∏≠</span>
                                            </div>
                                            <div class="seat-progress" style="width: 100px; height: 8px; background: #444; border-radius: 4px; overflow: hidden;">
                                                <?php 
                                                $occupancyRate = (($showing['totalSeats'] - $showing['availableSeats']) / $showing['totalSeats']) * 100;
                                                $progressColor = $occupancyRate > 80 ? '#dc3545' : ($occupancyRate > 50 ? '#ffc107' : '#28a745');
                                                ?>
                                                <div style="width: <?php echo $occupancyRate; ?>%; height: 100%; background: <?php echo $progressColor; ?>; transition: width 0.3s;"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Á•®ÂÉπËàáË≥ºÁ•®ÊåâÈàï -->
                                <div class="booking-action" style="text-align: center; min-width: 150px;">
                                    <div class="ticket-price" style="margin-bottom: 20px;">
                                        <div style="color: var(--text-muted); font-size: 14px; margin-bottom: 5px;">Á•®ÂÉπ</div>
                                        <div style="font-size: 28px; font-weight: bold; color: var(--primary-color);">
                                            NT$ <?php echo number_format($showing['ticketPrice']); ?>
                                        </div>
                                    </div>
                                    
                                    <?php if ($showing['availableSeats'] > 0): ?>
                                        <a href="select_seat.php?showingId=<?php echo $showing['showingId']; ?>" 
                                           class="btn btn-primary" 
                                           style="width: 100%; padding: 15px; font-size: 16px; font-weight: bold;">
                                            üéüÔ∏è Á´ãÂç≥Ë≥ºÁ•®
                                        </a>
                                    <?php else: ?>
                                        <button class="btn btn-secondary" disabled style="width: 100%; padding: 15px; font-size: 16px;">
                                            üòû Â∑≤ÂîÆÂÆå
                                        </button>
                                    <?php endif; ?>
                                    
                                    <div style="margin-top: 15px;">
                                        <a href="../browse/movie_detail.php?id=<?php echo $showing['movieId']; ?>" 
                                           class="btn btn-info" 
                                           style="width: 100%; padding: 10px; font-size: 14px;">
                                            üìñ ÈõªÂΩ±Ë©≥ÊÉÖ
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <?php endforeach; ?>
                </div>
            <?php else: ?>
                <div class="text-center" style="padding: 80px 20px;">
                    <div style="font-size: 80px; margin-bottom: 30px; opacity: 0.3;">üé¨</div>
                    <h3 class="text-muted">Ê≤íÊúâÊâæÂà∞Á¨¶ÂêàÊ¢ù‰ª∂ÁöÑÂ†¥Ê¨°</h3>
                    <p class="text-muted">Ë´ãË™øÊï¥ÁØ©ÈÅ∏Ê¢ù‰ª∂ÊàñÈÅ∏ÊìáÂÖ∂‰ªñÊó•Êúü</p>
                    
                    <div style="margin-top: 30px;">
                        <button class="btn btn-primary" onclick="clearFilters()" style="margin-right: 10px;">
                            üîÑ ÈáçÊñ∞ÈÅ∏Êìá
                        </button>
                        <a href="../browse/movies.php" class="btn btn-secondary">
                            üé• ÁÄèË¶ΩÈõªÂΩ±
                        </a>
                    </div>
                </div>
            <?php endif; ?>
        </div>
        
        <!-- ËøîÂõûÊåâÈàï -->
        <div class="text-center" style="margin-top: 40px;">
            <a href="../index.php" class="btn btn-secondary" style="padding: 15px 30px; font-size: 16px;">
                ‚Üê ËøîÂõûÊúÉÂì°È¶ñÈ†Å
            </a>
        </div>
    </div>
    
    <!-- È†ÅÂ∞æ‰Ωî‰ΩçÁ¨¶ -->
    <div id="footer-placeholder"></div>
    
    <!-- ËºâÂÖ•Ê†∏ÂøÉJavaScript -->
    <script src="/WeiYuCinema/static/js/script.js"></script>
    
    <script>
        // Ê∏ÖÈô§ÁØ©ÈÅ∏Ê¢ù‰ª∂
        function clearFilters() {
            document.getElementById('movieId').value = '';
            document.getElementById('cinemaId').value = '';
            document.getElementById('showDate').value = '';
            
            // ÈáçÊñ∞ËºâÂÖ•È†ÅÈù¢
            window.location.href = window.location.pathname;
        }
        
        // Â†¥Ê¨°Âç°ÁâáÊá∏ÂÅúÊïàÊûú
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.showing-card').forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-3px)';
                    this.style.boxShadow = '0 12px 30px rgba(0,0,0,0.6)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                    this.style.boxShadow = '0 8px 25px rgba(0,0,0,0.4)';
                });
            });
        });
    </script>
</body>
</html>